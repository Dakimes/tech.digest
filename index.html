<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Главная</title>
  <meta name="description" content="Главная страница каталога: цифровой радар и карточки технологий." />
  <script>
    (function(){
      var doc = document.documentElement;
      doc.classList.add('auth-check');
      try{
        if(localStorage.getItem('sci-auth') === 'true'){
          doc.classList.add('auth-ok');
        } else {
          window.location.replace('/login/');
        }
      } catch(err){
        window.location.replace('/login/');
      }
    })();
  </script>
  <link rel="icon" type="image/png" href="./assets/logo.png" />
  <style>
    html.auth-check body{ visibility:hidden; }
    html.auth-check.auth-ok body{ visibility:visible; }
    :where([hidden]){ display:none !important; }
    :root{
      --bg:#ffffff; --card:#ffffff; --muted:#4b5563; --text:#0b0d12;
      --blue-1:#00A7FF; --blue-2:#007BFF; --blue-3:#0062D1; --blue-4:#0047B3; --blue-6:#0B2F80;
      --line:#e6eef8; --shadow: 0 10px 30px rgba(0, 80, 170, .10); --radius:18px;
    }
    html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); font:16px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap{ max-width: 1200px; margin: 28px auto 64px; padding: 0 20px; }

    /* Header */
    header.hero{ display:flex; align-items:center; gap:16px; padding:16px 18px; border:1px solid var(--line); border-radius:var(--radius); background:linear-gradient(180deg, #f7fbff 0%, #fff 100%); box-shadow:var(--shadow); flex-wrap:wrap; }
    .logo{ height:56px; width:auto; }
    .brand{ font-weight:800; font-size: clamp(18px,2.2vw,22px); letter-spacing:.2px; color:var(--blue-4); }
    .nav{ margin-left:auto; }
    .login-link{ display:inline-flex; align-items:center; gap:8px; padding:10px 16px; border-radius:12px; background:var(--blue-4); color:#fff; font-weight:700; text-decoration:none; box-shadow:0 6px 18px rgba(0,71,179,.18); transition:background .2s ease, transform .2s ease; }
    .login-link:hover{ background:var(--blue-3); transform:translateY(-1px); }
    .login-link:focus-visible{ outline:3px solid rgba(0,123,255,.35); outline-offset:3px; }

    /* Blue top-level taxonomy band */
    .blueband{ margin-top:14px; background: linear-gradient(180deg, var(--blue-4), var(--blue-6)); color:#fff; border-radius: var(--radius); box-shadow: var(--shadow); border:1px solid rgba(255,255,255,.15); }
    .blueband .inner{ display:flex; flex-wrap:wrap; gap:14px 18px; padding:14px 18px; align-items:center; }
    .tagb{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.22); font-size:13px; color:#fff; }
    .legend{ display:flex; flex-wrap:wrap; gap:10px; margin-left:auto; }
    .lg{ display:inline-flex; align-items:center; gap:8px; font-size:12px; opacity:.9; }
    .lg i{ width:10px; height:10px; display:inline-block; border-radius:50%; }
    .m1{ background:#86d6ff; } .m2{ background:#4eb2ff; } .m3{ background:#1c8fff; } .m4{ background:#0b5fd1; }

    /* Search */
    .search{ position:relative; display:flex; gap:10px; margin:18px 0 26px; }
    .search input{ width:100%; border:2px solid var(--blue-2); border-radius:14px; padding:14px 14px 14px 42px; font-size:16px; outline:none; box-shadow: 0 6px 22px rgba(0,123,255,.12); }
    .search input:focus{ border-color: var(--blue-2); box-shadow: 0 0 0 4px rgba(0,123,255,.12); }
    .search .clear{
      border:none;
      background:#f2f7ff;
      color:var(--blue-3);
      padding:12px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      transition:background .2s ease, color .2s ease, box-shadow .2s ease;
    }
    .search .clear:hover:not(:disabled){ background:#e6f0ff; }
    .search .clear:focus-visible{ outline:3px solid rgba(0,123,255,.35); outline-offset:3px; }
    .search .clear:disabled{
      opacity:.65;
      cursor:not-allowed;
      box-shadow:none;
    }

    /* Radar */
    .radar-wrap{ position:relative; border:1px solid var(--line); border-radius:var(--radius); padding:16px; background: #fff; box-shadow: var(--shadow); }
    .radar{ position:relative; width:100%; max-width:100%; height: 360px; margin:auto; background:
      radial-gradient(circle at center, rgba(0,123,255,.04) 0 1px, transparent 1px) 0 0/24px 24px; border-radius:14px; overflow:hidden; }
    .radar-empty{
      position:absolute;
      inset:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      background:rgba(255,255,255,.92);
      border:1px dashed var(--line);
      border-radius:12px;
      color:var(--muted);
      font-weight:600;
      padding:18px;
      pointer-events:none;
    }
    .radar svg{ position:absolute; inset:0; width:100%; height:100%; }
    .ring-label{ display:block; font-size:12px; fill:var(--blue-4); font-weight:600; opacity:.85; }
    .axis-line{ stroke:rgba(0,71,179,.25); stroke-width:1; stroke-dasharray:4 4; }
    .ring-zone{ stroke:rgba(0,71,179,.35); stroke-width:1.2; }

    .radar-legend{ display:flex; gap:16px; flex-wrap:wrap; align-items:center; justify-content:flex-start; padding-top:10px; font-size:12px; color:#2b3b6a; }
    .radar-legend .lg{ display:inline-flex; align-items:center; gap:8px; }
    .radar-legend i{ width:12px; height:12px; display:inline-block; border-radius:50%; }
    .m1{ background:#86d6ff; } .m2{ background:#4eb2ff; } .m3{ background:#1c8fff; } .m4{ background:#0b5fd1; }

    .dot{ cursor:pointer; transition: opacity .15s ease; outline:none; }
    .dot circle{ filter: drop-shadow(0 2px 6px rgba(0,0,0,.15)); transition: transform .15s ease; }
    .dot:hover circle{ transform:scale(1.08); }
    .dot:focus-visible circle{ outline:3px solid rgba(0,123,255,.45); outline-offset:2px; }
    .radar-tooltip{
      position:absolute;
      pointer-events:none;
      background:rgba(12,22,44,.96);
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      font-size:13px;
      line-height:1.4;
      box-shadow:0 10px 30px rgba(10,25,65,.28);
      max-width:240px;
      z-index:20;
      transform:translate(-50%, -120%);
      opacity:0;
      transition:opacity .12s ease;
    }
    .radar-tooltip.is-visible{ opacity:1; }
    .radar-tooltip strong{ display:block; font-size:13px; margin-bottom:4px; color:#8dd2ff; }
    .radar-tooltip span{ display:block; font-size:12px; color:#dcecff; }

    /* Board */
    h2{
      margin: 26px 0 16px;
      font-size: clamp(20px,2.4vw,28px);
      color:var(--blue-4);
      padding-bottom:12px;
      background:
        linear-gradient(90deg, var(--blue-3), var(--blue-1))
        no-repeat left bottom / 56px 4px;
    }

    .board{ display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:14px; }
    .board-empty{
      margin: 18px 0 0;
      padding:18px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#f5f8ff;
      color:var(--muted);
      text-align:center;
      font-weight:600;
      box-shadow:var(--shadow);
    }
    @media (max-width: 980px){ .board{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 760px){
      header.hero{ flex-direction:column; align-items:flex-start; }
      .nav{ width:100%; display:flex; justify-content:flex-start; }
      .login-link{ width:100%; justify-content:center; }
    }
    @media (max-width: 640px){
      .board{ grid-template-columns: 1fr; }
      .radar{ height:320px; }
      .radar-wrap{ padding:12px; }
    }
    @media (max-width: 480px){
      header.hero{ padding:14px; }
      .search{ flex-direction:column; }
      .search input{ padding-left:38px; }
      .radar{ height:280px; }
    }

    @media print{
      .radar-tooltip{ display:none !important; }
    }

    .tile{ position:relative; background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px; box-shadow: var(--shadow); text-decoration:none; color:inherit; display:flex; flex-direction:column; gap:10px; }
    .tile:hover{ border-color: var(--blue-2); box-shadow: 0 8px 30px rgba(0,123,255,.12); }
    .tile .title{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .pill{ display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; color:var(--blue-3); background:#fff; border:1.6px solid var(--blue-2); }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{ background:#fff; border:1.6px solid var(--blue-2); color:var(--blue-3); padding:6px 8px; border-radius:8px; font-size:12px; font-weight:600; }

    footer{ color:var(--muted); font-size:12px; margin-top: 28px; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <img src="./assets/logo.png" alt="SCI logo" class="logo" />
      <div class="brand">Технологический радар</div>
      <nav class="nav" aria-label="Главная навигация">
        <a class="login-link" href="./login/">Войти</a>
      </nav>
    </header>

    <div class="search" role="search">
      <div class="box" style="position:relative; flex:1">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); width:18px; height:18px; opacity:.6"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" fill="none"></circle><line x1="16.5" y1="16.5" x2="22" y2="22" stroke="currentColor" stroke-width="2"></line></svg>
        <input id="q" type="search" placeholder="Поиск по технологиям…" aria-label="Поиск по каталогу" autofocus />
      </div>
      <button class="clear" id="clearBtn" type="button">Очистить</button>
    </div>

    <section class="radar-wrap" aria-label="Цифровой радар технологий">
      <div id="radar" class="radar"></div>
      <div id="radarEmpty" class="radar-empty" hidden role="status" aria-live="polite">Нет технологий для отображения. Измените поисковый запрос.</div>
      <div class="radar-legend" aria-label="Легенда зрелости">
        <span class="lg"><i class="m1"></i>Наблюдение</span>
        <span class="lg"><i class="m2"></i>Пилоты</span>
        <span class="lg"><i class="m3"></i>Продукция</span>
        <span class="lg"><i class="m4"></i>Масштаб</span>
      </div>
    </section>

    <h2>Доска технологий</h2>
    <section id="board" class="board" aria-live="polite"></section>
    <p id="boardEmpty" class="board-empty" hidden role="status" aria-live="polite">По текущему запросу технологий не найдено. Попробуйте изменить критерии поиска.</p>

    <footer>© 2025 • SCI • Главная по технологиям KG</footer>
  </div>

<script>
// === ДАННЫЕ ===
// Базовый субдомен для технологии (замените на ваш домен)
// Путь на домене scisource.ru: https://scisource.ru/<slug>/
const BASE_URL = '/';
const makeLink = (slug) => `${BASE_URL}${slug}/`; 

const technologies = [
  {
    id:'ekg-platform',
    slug:'ekg',
    name:'Платформы корпоративных графов знаний',
    keys:['RDF/OWL','SPARQL 1.2','SHACL/SHEx','JSON‑LD','PROV‑O','SKOS'],
    link: makeLink('ekg'),
    ring:'production',
    angle: 40
  },
  {
    id:'semantic-pipelines',
    slug:'semantic-pipelines',
    name:'Семантические конвейеры интеграции и обработки данных',
    keys:['Hybrid Vector-SQL • ANN/HNSW','ISO GQL • SPARQL 1.2 • PROV-O','Semantic Retrieval • RAG Pipelines'],
    link: makeLink('semantic-pipelines'),
    ring:'pilot',
    angle: 100
  },
  {
    id:'streaming-platforms',
    slug:'streaming',
    name:'Распределённые платформы потоковой передачи событий',
    keys:['Event Time','Stateful Streams','Kafka/Flink','Schema Registry','Exactly-once','CloudEvents'],
    link: makeLink('streaming'),
    ring:'pilot',
    angle: 140
  },
  {
    id:'distributed-streaming-rt',
    slug:'streaming-rt',
    name:'Платформы распределённой потоковой передачи и обработки потоков',
    keys:['Event Time','Watermarks','Streaming SQL','CEP','Schema Registry','Exactly-once'],
    link: makeLink('streaming-rt'),
    ring:'pilot',
    angle: 220
  },
  {
    id:'blockchain-governance',
    slug:'blockchain-governance',
    name:'Корпоративные системы управления данными и целостностью на основе блокчейна',
    keys:['RDF/RDFS','OWL 2','SPARQL 1.2','SHACL','PROV-O','OBDA/R2RML'],
    link: makeLink('blockchain-governance'),
    ring:'pilot',
    angle: 310
  },
  {
    id:'disaggregated-storage',
    slug:'disaggregated-storage',
    name:'Дезагрегированные распределённые архитектуры хранения',
    keys:['HL7 FHIR R4/R5','OMOP CDM','FHIR Bulk Data $export','Terminology Services','SMART on FHIR / OAuth 2.0','Parquet & BigQuery'],
    link: makeLink('disaggregated-storage'),
    ring:'observe',
    angle: 350
  }
];

// === РАДАР ===
const radarEl = document.getElementById('radar');
const radarEmptyEl = document.getElementById('radarEmpty');
const radarWrapEl = radarEl ? radarEl.parentElement : null;
const boardEl = document.getElementById('board');
const boardEmptyEl = document.getElementById('boardEmpty');
const rings = [
  {id:'observe',   label:'Наблюдение', r:80,  color:'#86d6ff'},
  {id:'pilot',     label:'Пилоты',     r:130, color:'#4eb2ff'},
  {id:'production',label:'Продукция',  r:180, color:'#1c8fff'},
  {id:'scale',     label:'Масштаб',    r:230, color:'#0b5fd1'}
];
const ringLabelsById = rings.reduce((acc, ring)=>{ acc[ring.id] = ring.label; return acc; }, {});
let lastRadarData = technologies;
let radarTooltipEl = null;
let radarTooltipTimer = null;

if(radarWrapEl){
  radarTooltipEl = radarWrapEl.querySelector('.radar-tooltip');
  if(!radarTooltipEl){
    radarTooltipEl = document.createElement('div');
    radarTooltipEl.className = 'radar-tooltip';
    radarTooltipEl.setAttribute('role','tooltip');
    radarTooltipEl.hidden = true;
    radarWrapEl.appendChild(radarTooltipEl);
  }
}

function polarToXY(cx, cy, r, angleDeg){
  const a = (angleDeg - 90) * Math.PI/180; // 0° вверх
  return { x: cx + r * Math.cos(a), y: cy + r * Math.sin(a) };
}

function renderRadar(data){
  if(!radarEl){ return; }
  const items = Array.isArray(data) ? data : [];
  lastRadarData = items;
  const w = radarEl.clientWidth || radarEl.offsetWidth || 800;
  const h = radarEl.clientHeight || 360;
  if(radarTooltipEl){
    if(radarTooltipTimer !== null){ cancelAnimationFrame(radarTooltipTimer); radarTooltipTimer = null; }
    radarTooltipEl.classList.remove('is-visible');
    radarTooltipEl.hidden = true;
  }
  const cx = w/2, cy = h/2;
  const maxR = Math.min(w,h)/2 - 24;
  const scale = maxR / rings[rings.length-1].r;

  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);

  const defs = document.createElementNS(svg.namespaceURI,'defs');
  const lg = document.createElementNS(svg.namespaceURI,'linearGradient');
  lg.setAttribute('id','grad'); lg.setAttribute('x1','0'); lg.setAttribute('x2','1');
  const s1 = document.createElementNS(svg.namespaceURI,'stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','var(--blue-1)');
  const s2 = document.createElementNS(svg.namespaceURI,'stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','var(--blue-2)');
  lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg); svg.appendChild(defs);

  const ringGroup = document.createElementNS(svg.namespaceURI,'g');
  rings.forEach((r, idx)=>{
    const R = r.r * scale;
    const c = document.createElementNS(svg.namespaceURI,'circle');
    c.setAttribute('cx', cx); c.setAttribute('cy', cy); c.setAttribute('r', R);
    c.setAttribute('class','ring-zone');
    c.setAttribute('fill', idx % 2 === 0 ? 'rgba(0,123,255,.09)' : 'rgba(0,123,255,.05)');
    ringGroup.appendChild(c);

    const t = document.createElementNS(svg.namespaceURI,'text');
    t.setAttribute('x', cx);
    t.setAttribute('y', Math.max(18, cy - R + 14));
    t.setAttribute('class','ring-label');
    t.setAttribute('text-anchor','middle');
    t.textContent = r.label;
    ringGroup.appendChild(t);
  });
  svg.appendChild(ringGroup);

  const axes = document.createElementNS(svg.namespaceURI,'g');
  const axisCount = 8;
  for(let i=0;i<axisCount;i++){
    const angle = (360/axisCount)*i;
    const end = polarToXY(cx, cy, rings[rings.length-1].r * scale, angle);
    const line = document.createElementNS(svg.namespaceURI,'line');
    line.setAttribute('x1', cx); line.setAttribute('y1', cy);
    line.setAttribute('x2', end.x); line.setAttribute('y2', end.y);
    line.setAttribute('class','axis-line');
    axes.appendChild(line);
  }
  svg.appendChild(axes);

  if(!items.length){
    radarEl.innerHTML = '';
    radarEl.appendChild(svg);
    if(radarEmptyEl){ radarEmptyEl.hidden = false; }
    if(radarTooltipEl){
      if(radarTooltipTimer !== null){ cancelAnimationFrame(radarTooltipTimer); radarTooltipTimer = null; }
      radarTooltipEl.classList.remove('is-visible');
      radarTooltipEl.hidden = true;
    }
    return;
  }

  items.forEach((item, idx)=>{
    const R = (rings.find(r=>r.id===item.ring)?.r || rings[0].r) * scale;
    const pos = polarToXY(cx, cy, R, item.angle || (40 + idx*30));

    const g = document.createElementNS(svg.namespaceURI,'g'); g.setAttribute('class','dot');
    const circle = document.createElementNS(svg.namespaceURI,'circle');
    circle.setAttribute('cx', pos.x); circle.setAttribute('cy', pos.y); circle.setAttribute('r', 10);
    circle.setAttribute('fill','url(#grad)'); circle.setAttribute('stroke','var(--blue-3)'); circle.setAttribute('stroke-width','1');

    g.appendChild(circle);
    const go = ()=> window.location.href = item.link;
    g.addEventListener('click', go);
    g.setAttribute('role','link'); g.setAttribute('tabindex','0');
    g.addEventListener('keydown', (e)=>{ if(e.key==='Enter') go(); });

    const summary = Array.isArray(item.keys) ? item.keys.join('; ') : '';
    g.setAttribute('aria-label', summary ? `${item.name}. ${summary}` : item.name);
    circle.setAttribute('aria-hidden','true');

    const showTooltip = ()=>{
      if(!radarTooltipEl || !radarWrapEl){ return; }
      radarTooltipEl.innerHTML = `<strong>${item.name}</strong>${summary ? `<span>${summary}</span>` : ''}`;
      const wrapRect = radarWrapEl.getBoundingClientRect();
      const svgRect = svg.getBoundingClientRect();
      const scaleX = svgRect.width / w;
      const scaleY = svgRect.height / h;
      const left = svgRect.left - wrapRect.left + pos.x * scaleX;
      const top = svgRect.top - wrapRect.top + pos.y * scaleY;
      radarTooltipEl.style.left = `${left}px`;
      radarTooltipEl.style.top = `${top}px`;
      radarTooltipEl.hidden = false;
      if(radarTooltipTimer !== null){ cancelAnimationFrame(radarTooltipTimer); }
      radarTooltipTimer = requestAnimationFrame(()=>{
        radarTooltipEl.classList.add('is-visible');
        radarTooltipTimer = null;
      });
    };
    const hideTooltip = ()=>{
      if(!radarTooltipEl){ return; }
      if(radarTooltipTimer !== null){ cancelAnimationFrame(radarTooltipTimer); radarTooltipTimer = null; }
      radarTooltipEl.classList.remove('is-visible');
      radarTooltipEl.hidden = true;
    };
    g.addEventListener('mouseenter', showTooltip);
    g.addEventListener('focus', showTooltip);
    g.addEventListener('mouseleave', hideTooltip);
    g.addEventListener('blur', hideTooltip);
    g.addEventListener('touchstart', showTooltip, { passive: true });
    g.addEventListener('touchend', hideTooltip);
    g.addEventListener('touchcancel', hideTooltip);

    svg.appendChild(g);
  });

  radarEl.innerHTML = '';
  radarEl.appendChild(svg);
  if(radarEmptyEl){ radarEmptyEl.hidden = true; }
  if(radarTooltipEl){
    if(radarTooltipTimer !== null){ cancelAnimationFrame(radarTooltipTimer); radarTooltipTimer = null; }
    radarTooltipEl.classList.remove('is-visible');
    radarTooltipEl.hidden = true;
  }
}

// === ДОСКА ===
function chip(el, text){ const s=document.createElement('span'); s.className='chip'; s.textContent=text; el.appendChild(s); }

function renderBoard(list){
  if(!boardEl) return;
  const items = Array.isArray(list) ? list : [];
  boardEl.innerHTML = '';
  const hasItems = items.length > 0;
  if(boardEmptyEl){
    boardEmptyEl.hidden = hasItems;
  }
  if(!hasItems){
    return;
  }
  items.forEach(item=>{
    const a = document.createElement('a');
    a.href = item.link; a.className='tile'; a.setAttribute('data-id', item.id);

    const title = document.createElement('div'); title.className='title';
    const h = document.createElement('div'); h.style.fontWeight='800'; h.textContent=item.name;
    title.appendChild(h);

    const ringLabel = ringLabelsById[item.ring];
    if(ringLabel){
      const pill = document.createElement('span');
      pill.className = 'pill';
      pill.textContent = ringLabel;
      pill.setAttribute('aria-label', `Зрелость: ${ringLabel}`);
      title.appendChild(pill);
    }

    const chips = document.createElement('div'); chips.className='chips';
    (item.keys || []).slice(0,6).forEach(k=> chip(chips,k));

    a.appendChild(title); a.appendChild(chips);
    boardEl.appendChild(a);
  });
}

// === ПОИСК ===
function setupSearch(){
  const input = document.getElementById('q');
  const clearBtn = document.getElementById('clearBtn');
  if(!input) return;
  const base = [...technologies];
  const norm = (s)=> (s||'').toString().toLowerCase();
  const updateClearState = ()=>{
    if(clearBtn){
      clearBtn.disabled = !input.value.trim();
    }
  };
  function filter(){
    const terms = norm(input.value).split(/\s+/).filter(Boolean);
    if(!terms.length){
      renderBoard(base);
      renderRadar(base);
      updateClearState();
      return;
    }
    const makeBag = (t)=> [t.name, t.slug, t.ring, ringLabelsById[t.ring], ...(t.keys||[])]
      .filter(Boolean)
      .map(norm)
      .join(' ');
    let res = base.filter(t=> {
      const bag = makeBag(t);
      return terms.every(term => bag.includes(term));
    });
    if(!res.length){
      res = base.filter(t=> {
        const bag = makeBag(t);
        return terms.some(term => bag.includes(term));
      });
    }
    renderBoard(res);
    renderRadar(res);
    updateClearState();
  }
  input.addEventListener('input', filter);
  if(clearBtn){
    clearBtn.addEventListener('click', ()=>{
      input.value = '';
      filter();
      input.focus();
    });
  }
  updateClearState();
}

// init
  renderRadar(technologies);
  renderBoard(technologies);
  setupSearch();
  let radarResizeTimer;
  window.addEventListener('resize', ()=>{
    clearTimeout(radarResizeTimer);
    radarResizeTimer = setTimeout(()=> renderRadar(lastRadarData), 160);
  });

const loginLink = document.querySelector('.login-link');
function isAuthenticated(){
  try{
    return localStorage.getItem('sci-auth') === 'true';
  } catch(err){
    return false;
  }
}
function configureLoginLink(){
  if(!loginLink) return;
  const authed = isAuthenticated();
  if(authed){
    loginLink.textContent = 'Выйти';
    loginLink.href = '#logout';
    loginLink.setAttribute('aria-label', 'Выйти из аккаунта');
    loginLink.onclick = (event)=>{
      event.preventDefault();
      try{
        localStorage.removeItem('sci-auth');
      } catch(err){
        /* ignore */
      }
      configureLoginLink();
      window.location.replace('/login/');
    };
  } else {
    loginLink.textContent = 'Войти';
    loginLink.href = './login/';
    loginLink.removeAttribute('aria-label');
    loginLink.onclick = null;
  }
}

configureLoginLink();
window.addEventListener('storage', configureLoginLink);
</script>
</body>
</html>
